{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { parsePath, PathInstruction } from './svg-path';\r\nimport getBezierPoints from 'adaptive-bezier-curve';\r\n\r\nexport type HPGLCommand = 'PU' | 'PD' | 'PA';\r\nexport type HPGLInstruction = [HPGLCommand, ...number[]];\r\nexport type HPGLProgram = HPGLInstruction[];\r\n\r\nexport function buildHPGL(program: HPGLProgram, prefix = '', suffix = ''): string {\r\n\treturn prefix + program.map(([cmd, ...vals]) => cmd + vals.join(',') + ';').join('') + suffix;\r\n}\r\n\r\nexport function svgToHPGL(svgStr: string, segmentsPerUnit = 0.08): HPGLProgram {\r\n\tconst svg = getSvgDoc(svgStr);\r\n\tif (!svg) throw Error('Invalid SVG supplied');\r\n\tconst hpgl: HPGLProgram = [['PA']];\r\n\r\n\tsvg.querySelectorAll('line').forEach(line => {\r\n\t\tconst tf = getTransformer(line);\r\n\t\thpgl.push(PU(tf, svgVal(line.x1), svgVal(line.y1)));\r\n\t\thpgl.push(PD(tf, svgVal(line.x2), svgVal(line.y2)));\r\n\t});\r\n\r\n\tsvg.querySelectorAll('polyline').forEach(polyline => {\r\n\t\tconst tf = getTransformer(polyline);\r\n\t\tconst points = polyline.points;\r\n\t\tif (points[0]) hpgl.push(PU(tf, points[0]?.x, points[0]?.y));\r\n\t\tfor (const pt of points) hpgl.push(PD(tf, pt.x, pt.y));\r\n\t});\r\n\r\n\tsvg.querySelectorAll('circle').forEach(circle => {\r\n\t\tconst tf = getTransformer(circle);\r\n\t\tconst { cx, cy, r } = svgVals(circle, ['cx', 'cy', 'r']);\r\n\t\tconst circum = 2 * Math.PI * r;\r\n\t\tconst segments = circum * segmentsPerUnit;\r\n\t\thpgl.push(PU(tf, cx + r, cy));\r\n\t\thpgl.push(...getArcPoints(cx, cy, r, r, 0, 2 * Math.PI, segments).map(pt => PD(tf, ...pt)));\r\n\t});\r\n\r\n\tsvg.querySelectorAll('ellipse').forEach(ellipse => {\r\n\t\tconst tf = getTransformer(ellipse);\r\n\t\tconst { cx, cy, rx, ry } = svgVals(ellipse, ['cx', 'cy', 'rx', 'ry']);\r\n\t\tconst circum = Math.PI * (rx + ry); // approx.\r\n\t\tconst segments = circum * segmentsPerUnit;\r\n\t\thpgl.push(PU(tf, cx + rx, cy));\r\n\t\thpgl.push(...getArcPoints(cx, cy, rx, ry, 0, 2 * Math.PI, segments).map(pt => PD(tf, ...pt)));\r\n\t});\r\n\r\n\tsvg.querySelectorAll('rect').forEach(rect => {\r\n\t\tconst tf = getTransformer(rect);\r\n\t\tconst { width: w, height: h, x, y } = svgVals(rect, ['width', 'height', 'x', 'y']);\r\n\t\tconst rx = Math.min(w / 2, svgVal(rect.rx) || svgVal(rect.ry) || 0);\r\n\t\tconst ry = Math.min(h / 2, svgVal(rect.ry) || svgVal(rect.rx) || 0);\r\n\t\tif (!rx || !ry) {\r\n\t\t\thpgl.push(PU(tf, x, y));\r\n\t\t\thpgl.push(PD(tf, x + w, y));\r\n\t\t\thpgl.push(PD(tf, x + w, y + h));\r\n\t\t\thpgl.push(PD(tf, x, y + h));\r\n\t\t\thpgl.push(PD(tf, x, y));\r\n\t\t} else {\r\n\t\t\tconst circum = 0.25 * Math.PI * (rx + ry); // approx.\r\n\t\t\tconst segments = circum * segmentsPerUnit;\r\n\t\t\thpgl.push(PU(tf, x, y + ry));\r\n\t\t\thpgl.push(\r\n\t\t\t\t...[\r\n\t\t\t\t\t...getArcPoints(x + rx, y + ry, rx, ry, Math.PI, 1.5 * Math.PI, segments),\r\n\t\t\t\t\t...getArcPoints(x + w - rx, y + ry, rx, ry, 1.5 * Math.PI, 2 * Math.PI, segments),\r\n\t\t\t\t\t...getArcPoints(x + w - rx, y + h - ry, rx, ry, 0, 0.5 * Math.PI, segments),\r\n\t\t\t\t\t...getArcPoints(x + rx, y + h - ry, rx, ry, 0.5 * Math.PI, Math.PI, segments),\r\n\t\t\t\t].map(pt => PD(tf, ...pt))\r\n\t\t\t);\r\n\t\t\thpgl.push(PD(tf, x, y + ry));\r\n\t\t}\r\n\t});\r\n\r\n\tsvg.querySelectorAll('path').forEach(path => {\r\n\t\tconst tf = getTransformer(path);\r\n\t\tconst d = path.getAttribute('d');\r\n\t\tif (!d) return;\r\n\t\tlet currX = 0;\r\n\t\tlet currY = 0;\r\n\t\tfunction updateCurr(ins: PathInstruction) {\r\n\t\t\tif ('x' in ins) currX = ins.x;\r\n\t\t\tif ('y' in ins) currY = ins.y;\r\n\t\t}\r\n\t\tconst instructions = parsePath(d);\r\n\t\tconsole.log('Path', instructions);\r\n\t\tinstructions.forEach((ins, insI) => {\r\n\t\t\tconst { cmd } = ins;\r\n\t\t\tif (cmd === 'M') {\r\n\t\t\t\thpgl.push(PU(tf, ins.x, ins.y));\r\n\t\t\t} else if (cmd === 'L') {\r\n\t\t\t\thpgl.push(PD(tf, ins.x, ins.y));\r\n\t\t\t} else if (cmd === 'H') {\r\n\t\t\t\thpgl.push(PD(tf, ins.x, currY));\r\n\t\t\t} else if (cmd === 'V') {\r\n\t\t\t\thpgl.push(PD(tf, currX, ins.y));\r\n\t\t\t} else if (cmd === 'C') {\r\n\t\t\t\tconst points = getBezierPoints([currX, currY], [ins.x1, ins.y1], [ins.x2, ins.y2], [ins.x, ins.y], 10);\r\n\t\t\t\thpgl.push(...PUD(tf, points));\r\n\t\t\t} else if (cmd === 'S') {\r\n\t\t\t\t// If the previous command was cubic Bézier (C or S): Reflect the second control point.\r\n\t\t\t\t// If the previous command was anything else: Treat the first control point as the current point.\r\n\t\t\t\tconst preCmd = instructions[insI - 1];\r\n\t\t\t\tconst preHasC2 = preCmd && 'x2' in preCmd && 'y2' in preCmd;\r\n\t\t\t\tconst x1 = preHasC2 ? 2 * currX - preCmd.x2 : currX;\r\n\t\t\t\tconst y1 = preHasC2 ? 2 * currY - preCmd.y2 : currY;\r\n\t\t\t\tconst points = getBezierPoints([currX, currY], [x1, y1], [ins.x2, ins.y2], [ins.x, ins.y], 10);\r\n\t\t\t\thpgl.push(...PUD(tf, points));\r\n\t\t\t\tupdateCurr(ins);\r\n\t\t\t} else if (cmd === 'Q') {\r\n\t\t\t} else if (cmd === 'T') {\r\n\t\t\t} else if (cmd === 'A') {\r\n\t\t\t} else if (cmd === 'Z') {\r\n\t\t\t\tconst firstIns = instructions[0];\r\n\t\t\t\tconst firstX = firstIns?.cmd === 'M' ? firstIns.x : 0;\r\n\t\t\t\tconst firstY = firstIns?.cmd === 'M' ? firstIns.y : 0;\r\n\t\t\t\thpgl.push(PD(tf, firstX, firstY));\r\n\t\t\t}\r\n\t\t\tupdateCurr(ins);\r\n\t\t});\r\n\t});\r\n\r\n\treturn hpgl;\r\n}\r\n\r\nfunction getTransformer(element: SVGGraphicsElement): (x: number, y: number) => [number, number] {\r\n\tconst svg = element.ownerSVGElement;\r\n\tif (!svg) {\r\n\t\tconsole.warn('Could not retrieve ownerSVGElement');\r\n\t\treturn (x: number, y: number) => [Math.round(x), Math.round(y)];\r\n\t}\r\n\r\n\tlet ctm = svg.createSVGMatrix();\r\n\tlet currEl: SVGElement | null = element;\r\n\r\n\twhile (currEl) {\r\n\t\tconst currCtm = currEl instanceof SVGGraphicsElement && currEl.transform.baseVal.consolidate()?.matrix;\r\n\t\tif (currCtm) ctm = currCtm.multiply(ctm);\r\n\t\tcurrEl = currEl.parentNode instanceof SVGElement ? currEl.parentNode : null;\r\n\t}\r\n\r\n\tconst point = svg.createSVGPoint();\r\n\r\n\treturn (x: number, y: number) => {\r\n\t\t(point.x = x), (point.y = y);\r\n\t\tconst pointT = point.matrixTransform(ctm);\r\n\t\treturn [Math.round(pointT.x), Math.round(pointT.y)];\r\n\t};\r\n}\r\n// function getTransformer(element: SVGGraphicsElement): (x: number, y: number) => [number, number] {\r\n// \tconst ctm_ = element.transform.baseVal.consolidate()?.matrix;\r\n// \tconst svg_ = element.ownerSVGElement;\r\n// \tif (ctm_ && svg_) {\r\n// \t\tconst ctm = ctm_;\r\n// \t\tconst svg = svg_;\r\n// \t\treturn (x: number, y: number) => {\r\n// \t\t\tconst point = svg.createSVGPoint();\r\n// \t\t\t(point.x = x), (point.y = y);\r\n// \t\t\tconst pointT = point.matrixTransform(ctm);\r\n// \t\t\treturn [Math.round(pointT.x), Math.round(pointT.y)];\r\n// \t\t};\r\n// \t} else {\r\n// \t\tconsole.warn('Could not retrieve svg transformation matrix');\r\n// \t\treturn (x: number, y: number) => [Math.round(x), Math.round(y)];\r\n// \t}\r\n// }\r\n\r\nfunction getSvgDoc(svgStr: string): SVGSVGElement | null {\r\n\tif (typeof window === 'undefined') {\r\n\t\tconst { JSDOM } = require('jsdom');\r\n\t\tconst dom = new JSDOM(svgStr, { contentType: 'image/svg+xml' });\r\n\t\tconst doc = dom.window.document;\r\n\t\treturn doc.querySelector('svg');\r\n\t} else {\r\n\t\tconst parser = new DOMParser();\r\n\t\tconst doc = parser.parseFromString(svgStr, 'image/svg+xml');\r\n\t\treturn doc.querySelector('svg');\r\n\t}\r\n}\r\n\r\nfunction svgVal(prop: SVGAnimatedLength) {\r\n\treturn prop.baseVal.value || 0;\r\n}\r\n\r\nfunction svgVals<T extends SVGGraphicsElement & Record<U, { baseVal: { value: number } }>, U extends keyof T>(\r\n\tel: T,\r\n\tprops: U[]\r\n) {\r\n\tconst vals = {} as Record<U, number>;\r\n\tfor (const prop of props) {\r\n\t\tif (!el[prop]?.baseVal) {\r\n\t\t\tconsole.warn(`Prop ${String(prop)} not in Element`, el);\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tvals[prop] = el[prop].baseVal.value || 0;\r\n\t}\r\n\treturn vals;\r\n}\r\n\r\nfunction getArcPoints(\r\n\tcx: number,\r\n\tcy: number,\r\n\trx: number,\r\n\try: number,\r\n\tstartAngle: number,\r\n\tendAngle: number,\r\n\t/** Will be rounded and changed to min of `2` */\r\n\tsegments: number\r\n) {\r\n\tsegments = Math.max(2, Math.round(segments));\r\n\tconst arcPoints: [number, number][] = [];\r\n\tfor (let i = 0; i <= segments; i++) {\r\n\t\tconst angle = startAngle + (i * (endAngle - startAngle)) / segments;\r\n\t\tarcPoints.push([cx + rx * Math.cos(angle), cy + ry * Math.sin(angle)]);\r\n\t}\r\n\treturn arcPoints;\r\n}\r\n\r\nfunction PU(tf: ReturnType<typeof getTransformer>, x: number, y: number): HPGLInstruction {\r\n\treturn ['PU', ...tf(x, y)];\r\n}\r\nfunction PD(tf: ReturnType<typeof getTransformer>, x: number, y: number): HPGLInstruction {\r\n\treturn ['PD', ...tf(x, y)];\r\n}\r\nfunction PUD(tf: ReturnType<typeof getTransformer>, points: [number, number][]): HPGLInstruction[] {\r\n\treturn points.map((pt, i) => (i === 0 ? PU(tf, ...pt) : PD(tf, ...pt)));\r\n}\r\n\r\n/** Implements and expects absolute coords (PA)  */\r\nexport function hpglFindBBox(hpgl: HPGLProgram) {\r\n\tconst cmds: HPGLCommand[] = ['PU', 'PD', 'PA'];\r\n\tlet xMin: number, xMax: number, yMin: number, yMax: number;\r\n\txMin = xMax = yMin = yMax = 0;\r\n\thpgl.forEach(([cmd, x, y, ...vals]) => {\r\n\t\tif (cmds.includes(cmd) && x && y && vals.length === 0) {\r\n\t\t\tif (x < xMin) xMin = x;\r\n\t\t\tif (x > xMax) xMax = x;\r\n\t\t\tif (y < yMin) yMin = y;\r\n\t\t\tif (y > yMax) yMax = y;\r\n\t\t}\r\n\t});\r\n\treturn { xMin, xMax, yMin, yMax, width: xMax - xMin, height: yMax - yMin };\r\n}\r\n\r\nexport function drawHPGL(canvas: HTMLCanvasElement, hpgl: HPGLProgram, width: number, height: number): void {\r\n\tcanvas.width = width;\r\n\tcanvas.height = height;\r\n\tconst ctx = canvas.getContext('2d');\r\n\tif (!ctx) throw new Error('Context of canvas unavailable');\r\n\r\n\t// ctx.lineWidth = 1;\r\n\t// ctx.strokeStyle = '#000000';\r\n\tctx.clearRect(0, 0, width, height);\r\n\tctx.beginPath();\r\n\r\n\thpgl.forEach(([cmd, x, y, ...vals]) => {\r\n\t\t// console.log({ cmd, x, y, vals });\r\n\t\tif (x === undefined || y === undefined || vals.length) return;\r\n\t\tif (cmd === 'PU') {\r\n\t\t\tctx.moveTo(x, y);\r\n\t\t} else if (cmd === 'PD') {\r\n\t\t\tctx.lineTo(x, y);\r\n\t\t}\r\n\t});\r\n\r\n\tctx.stroke();\r\n}\r\n"]}