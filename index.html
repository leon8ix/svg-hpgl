<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>SVG to HP-GL Test Page</title>
		<script type="module" defer>
			import { buildHPGL, svgToHPGL, drawHPGL } from './src/index.ts';
			window.buildHPGL = buildHPGL;
			window.svgToHPGL = svgToHPGL;

			const input = document.getElementById('input');
			const output = document.getElementById('output');
			const svgContainer = document.getElementById('svg');
			const canvas = document.getElementById('canvas');
			// const segmentsPerUnit = document.getElementById('segmentsPerUnit');
			// const offsetX = document.getElementById('offsetX');
			// const offsetY = document.getElementById('offsetY');
			// const rotation = document.getElementById('rotation');
			// const scale = document.getElementById('scale');
			// const res = document.getElementById('res');

			input.value = svg.innerHTML;

			function update() {
				const vals = {};
				document.querySelectorAll('[data-val]').forEach(input => (vals[input.id] = parseFloat(input.value)));
				vals.scale = (vals.scale || 1) * (vals.res || 1);
				console.log(vals);

				svgContainer.innerHTML = input.value;
				const svg = svgContainer.querySelector('svg');
				if (!svg) return console.warn('Invalid SVG supplied');
				const hpglProg = svgToHPGL(
					svg,
					[
						{ pen: 1, stroke: 'blue' },
						{ pen: 1, stroke: 'cyan' },
						{ pen: 2, stroke: 'red' },
						{ pen: 2, stroke: 'magenta' },
					],
					vals
				);
				const hpglStr = buildHPGL(hpglProg);
				// console.log(hpglStr, hpglProg);
				output.innerText = hpglStr;
				drawHPGL(canvas, hpglProg, 297 * (vals.res || 1), 210 * (vals.res || 1));
			}

			document.querySelectorAll('input, textarea').forEach(input => input.addEventListener('input', update));
			update();
		</script>
	</head>
	<body>
		<textarea id="input" cols="100" rows="16" style="width: 100%"></textarea>
		<div style="display: flex; gap: 1em; margin: 1em 0 0">
			<label for="segmentsPerUnit">segmentsPerUnit</label>
			<input type="number" data-val value="1" min="1" max="10" id="segmentsPerUnit" />
			<label for="offsetX">offsetX</label>
			<input type="number" data-val value="0" min="-50" max="50" step="10" id="offsetX" />
			<label for="offsetY">offsetY</label>
			<input type="number" data-val value="0" min="-50" max="50" step="10" id="offsetY" />
			<label for="rotation">rotation</label>
			<input type="number" data-val value="0" min="-360" max="360" step="15" id="rotation" />
			<label for="scale">scale</label>
			<input type="number" data-val value="1" min="0.5" max="5" step="0.25" id="scale" />
			<label for="res">res</label>
			<input type="number" data-val value="3" min="0.5" max="5" step="0.5" id="res" />
		</div>
		<div style="display: flex; gap: 1em; margin: 1em 0">
			<!-- <div id="svg">
				<svg
					xmlns="http://www.w3.org/2000/svg"
					xmlns:xlink="http://www.w3.org/1999/xlink"
					width="297"
					height="210"
					viewBox="0 0 297 210"
				>
					<rect x="0" y="0" width="297" height="210" fill="#ccc" />
					<circle cx="50" cy="50" r="35" fill="none" stroke="red" transform="scale(0.5)" />
					<g transform="rotate(10)">
						<rect
							x="100"
							y="50"
							width="76"
							height="47"
							rx="12"
							fill="none"
							stroke="red"
							transform="translate(60 60)"
						/>
						<line x1="100" y1="100" x2="200" y2="100" stroke="red" />
					</g>
					<polyline points="0,210 50,160 25,170 25,130" stroke="red" fill="none" />
					<path
						d="M224.4,410.1L204,363s44.151-25.489,47.337,3.186,23.669,18.662,23.669,18L254.893,423.3Z"
						transform="translate(-50 -330)"
						stroke="blue"
						fill="none"
					/>
				</svg>
			</div> -->
			<!-- <div id="svg">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 297 210" width="297" height="210" preserveAspectRatio="xMidYMid meet" class="ls"><defs></defs>
                  <g><svg id="Ebene_4" data-name="Ebene 4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240.94 155.91" x="14.5" y="8" width="88" height="96">
                    <rect width="240.94" height="155.91" rx="8.5" ry="8.5" fill="none" stroke="magenta" stroke-miterlimit="10" stroke-width=".25"></rect>
                    <line y1="80.22" x2="240.94" y2="80.22" fill="none" stroke="cyan" stroke-miterlimit="10" stroke-width=".25"></line>
                    <path d="M68.97,80.22c0-26.23,23.06-47.5,51.5-47.5s51.5,21.27,51.5,47.5" fill="none" stroke="magenta" stroke-miterlimit="10" stroke-width=".25"></path>
                  </svg></g>
                  <g><svg id="Ebene_4" data-name="Ebene 4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240.94 155.91" x="104.5" y="8" width="88" height="96">
                    <rect width="240.94" height="155.91" rx="8.5" ry="8.5" fill="none" stroke="magenta" stroke-miterlimit="10" stroke-width=".25"></rect>
                    <line y1="80.22" x2="240.94" y2="80.22" fill="none" stroke="cyan" stroke-miterlimit="10" stroke-width=".25"></line>
                    <path d="M68.97,80.22c0-26.23,23.06-47.5,51.5-47.5s51.5,21.27,51.5,47.5" fill="none" stroke="magenta" stroke-miterlimit="10" stroke-width=".25"></path>
                  </svg></g>
                  <g><svg id="Ebene_4" data-name="Ebene 4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240.94 155.91" x="194.5" y="8" width="88" height="96">
                    <rect width="240.94" height="155.91" rx="8.5" ry="8.5" fill="none" stroke="magenta" stroke-miterlimit="10" stroke-width=".25"></rect>
                    <line y1="80.22" x2="240.94" y2="80.22" fill="none" stroke="cyan" stroke-miterlimit="10" stroke-width=".25"></line>
                    <path d="M68.97,80.22c0-26.23,23.06-47.5,51.5-47.5s51.5,21.27,51.5,47.5" fill="none" stroke="magenta" stroke-miterlimit="10" stroke-width=".25"></path>
                  </svg></g>
                  <g><svg id="Ebene_4" data-name="Ebene 4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240.94 155.91" x="14.5" y="106" width="88" height="96">
                    <rect width="240.94" height="155.91" rx="8.5" ry="8.5" fill="none" stroke="magenta" stroke-miterlimit="10" stroke-width=".25"></rect>
                    <line y1="80.22" x2="240.94" y2="80.22" fill="none" stroke="cyan" stroke-miterlimit="10" stroke-width=".25"></line>
                    <path d="M68.97,80.22c0-26.23,23.06-47.5,51.5-47.5s51.5,21.27,51.5,47.5" fill="none" stroke="magenta" stroke-miterlimit="10" stroke-width=".25"></path>
                  </svg></g>
                  <g><svg id="Ebene_4" data-name="Ebene 4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240.94 155.91" x="104.5" y="106" width="88" height="96">
                    <rect width="240.94" height="155.91" rx="8.5" ry="8.5" fill="none" stroke="magenta" stroke-miterlimit="10" stroke-width=".25"></rect>
                    <line y1="80.22" x2="240.94" y2="80.22" fill="none" stroke="cyan" stroke-miterlimit="10" stroke-width=".25"></line>
                    <path d="M68.97,80.22c0-26.23,23.06-47.5,51.5-47.5s51.5,21.27,51.5,47.5" fill="none" stroke="magenta" stroke-miterlimit="10" stroke-width=".25"></path>
                  </svg></g>
                  <g><svg id="Ebene_4" data-name="Ebene 4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240.94 155.91" x="194.5" y="106" width="88" height="96">
                    <rect width="240.94" height="155.91" rx="8.5" ry="8.5" fill="none" stroke="magenta" stroke-miterlimit="10" stroke-width=".25"></rect>
                    <line y1="80.22" x2="240.94" y2="80.22" fill="none" stroke="cyan" stroke-miterlimit="10" stroke-width=".25"></line>
                    <path d="M68.97,80.22c0-26.23,23.06-47.5,51.5-47.5s51.5,21.27,51.5,47.5" fill="none" stroke="magenta" stroke-miterlimit="10" stroke-width=".25"></path>
                  </svg></g>
                  <circle fill="transparent" cx="12.5" cy="12.5" r="2.5" stroke="cyan" stroke-width="1"></circle><circle fill="transparent" cx="284.5" cy="12.5" r="2.5" stroke="cyan" stroke-width="1"></circle><circle fill="transparent" cx="12.5" cy="197.5" r="2.5" stroke="cyan" stroke-width="1"></circle><circle fill="transparent" cx="284.5" cy="197.5" r="2.5" stroke="cyan" stroke-width="1"></circle></svg>
				</svg> -->
			<div id="svg">
				<svg
					xmlns="http://www.w3.org/2000/svg"
					xmlns:xlink="http://www.w3.org/1999/xlink"
					version="1.1"
					viewBox="0 0 297 210"
					width="297"
					height="210"
					preserveAspectRatio="xMidYMid meet"
					class="ls"
				>
					<defs></defs>
					<g>
						<svg
							id="Ebene_4"
							data-name="Ebene 4"
							xmlns="http://www.w3.org/2000/svg"
							viewBox="0 0 240.94 155.91"
							x="14.5"
							y="8"
							width="88"
							height="96"
						>
							<rect
								width="240.94"
								height="155.91"
								rx="8.5"
								ry="8.5"
								fill="none"
								stroke="magenta"
								stroke-miterlimit="10"
								stroke-width=".25"
							></rect>
							<line
								y1="80.22"
								x2="240.94"
								y2="80.22"
								fill="none"
								stroke="cyan"
								stroke-miterlimit="10"
								stroke-width=".25"
							></line>
						</svg>
					</g>
					<g>
						<svg
							id="Ebene_4"
							data-name="Ebene 4"
							xmlns="http://www.w3.org/2000/svg"
							viewBox="0 0 240.94 155.91"
							x="104.5"
							y="8"
							width="88"
							height="96"
						>
							<rect
								width="240.94"
								height="155.91"
								rx="8.5"
								ry="8.5"
								fill="none"
								stroke="magenta"
								stroke-miterlimit="10"
								stroke-width=".25"
							></rect>
							<line
								y1="80.22"
								x2="240.94"
								y2="80.22"
								fill="none"
								stroke="cyan"
								stroke-miterlimit="10"
								stroke-width=".25"
							></line>
						</svg>
					</g>
					<circle fill="transparent" cx="12.5" cy="12.5" r="2.5" stroke="cyan" stroke-width="1"></circle>
					<circle fill="transparent" cx="284.5" cy="12.5" r="2.5" stroke="cyan" stroke-width="1"></circle>
					<circle fill="transparent" cx="12.5" cy="197.5" r="2.5" stroke="cyan" stroke-width="1"></circle>
					<circle fill="transparent" cx="284.5" cy="197.5" r="2.5" stroke="cyan" stroke-width="1"></circle>
				</svg>
			</div>
			<canvas id="canvas"></canvas>
		</div>
		<output id="output" style="word-break: break-all; display: block"></output>
		<style>
			svg,
			canvas {
				width: 38vw;
				height: auto;
			}
		</style>
		<!-- <rect
                x="0.5"
                y="0.5"
                width="76"
                height="47"
                fill="none"
                stroke="red"
                transform="translate(28 22)"
            /> -->
		<!-- d="M224.4,410.1L204,363s44.151-25.489,47.337,3.186,23.669,18.662,23.669,18L254.893,423.3" -->
	</body>
</html>
